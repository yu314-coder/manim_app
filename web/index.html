<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manim Studio - Professional Edition</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="ui-enhancements.css">
    <link rel="stylesheet" href="monaco/vs/editor/editor.main.css">
    <link rel="stylesheet" href="app_features.css?v=2025-01-26-v13">
    <link rel="stylesheet" href="fontawesome/css/all.min.css">
    <link rel="stylesheet" href="xterm/xterm.css">
    <style>
        /* Auto-save indicator */
        .autosave-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .autosave-indicator i {
            font-size: 14px;
        }

        .autosave-indicator.saved {
            color: #10b981;
        }

        .autosave-indicator.saving {
            color: #f59e0b;
        }

        .autosave-indicator.unsaved {
            color: #ef4444;
        }

        .autosave-indicator.saving i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Code Errors Panel */
        .code-errors-panel {
            height: 120px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
        }

        .errors-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .errors-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .errors-title i {
            color: #f59e0b;
        }

        #errorCount {
            color: #ef4444;
            font-weight: 600;
        }

        .errors-clear-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .errors-clear-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .errors-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .errors-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 100%;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .errors-empty i {
            color: #10b981;
            font-size: 16px;
        }

        .error-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px;
            margin-bottom: 6px;
            background: var(--bg-secondary);
            border-left: 3px solid #ef4444;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .error-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(2px);
        }

        .error-item.warning {
            border-left-color: #f59e0b;
        }

        .error-item .error-icon {
            color: #ef4444;
            margin-top: 2px;
        }

        .error-item.warning .error-icon {
            color: #f59e0b;
        }

        .error-content {
            flex: 1;
        }

        .error-location {
            font-size: 11px;
            color: var(--accent-primary);
            font-weight: 500;
            margin-bottom: 2px;
        }

        .error-message {
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        /* Monaco Editor Error Decorations */
        .errorLine {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
        }

        .warningLine {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid #f59e0b;
        }

        .errorGlyph {
            background: #ef4444;
            width: 4px !important;
            margin-left: 3px;
        }

        .warningGlyph {
            background: #f59e0b;
            width: 4px !important;
            margin-left: 3px;
        }

        /* Terminal auto-sizing - fills container like HTML */
        #terminalContainer {
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        #terminalContainer .xterm {
            flex: 1;
            height: 100% !important;
            width: 100% !important;
        }

        #terminalContainer .xterm-viewport {
            overflow-y: scroll !important; /* Keep scrollbar visible and stable */
            overflow-x: hidden !important;
            width: 100% !important;
            scrollbar-gutter: stable both-edges;
            scrollbar-width: auto; /* For Firefox */
            scrollbar-color: #8c939c #1a1d22; /* For Firefox */
        }

        /* Custom scrollbar for webkit browsers */
        #terminalContainer .xterm-viewport::-webkit-scrollbar {
            width: 14px;
        }

        #terminalContainer .xterm-viewport::-webkit-scrollbar-track {
            background: #1a1d22;
            border-left: 1px solid #2a2f36;
        }

        #terminalContainer .xterm-viewport::-webkit-scrollbar-thumb {
            background: #8c939c;
            border-radius: 8px;
            border: 2px solid #1a1d22;
            min-height: 48px;
        }

        #terminalContainer .xterm-viewport::-webkit-scrollbar-thumb:hover {
            background: #aeb4bb;
        }

        #terminalContainer .xterm-viewport::-webkit-scrollbar-thumb:active {
            background: #c2c8cf;
        }

        /* Toast Container */
        #toastContainer {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        /* Modern Toast Notification */
        .toast {
            pointer-events: auto;
            background: var(--bg-secondary);
            border-left: 4px solid #4299e1;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
            padding: 12px 16px;
            min-width: 200px;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.hiding {
            opacity: 0;
            transform: translateX(400px);
        }

        /* Toast Icon */
        .toast-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        /* Toast Message */
        .toast-message {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            line-height: 1.4;
        }

        /* Toast Progress Bar */
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: currentColor;
            opacity: 0.3;
            animation: toast-progress 3s linear forwards;
        }

        @keyframes toast-progress {
            from { width: 100%; }
            to { width: 0%; }
        }

        .toast:hover .toast-progress {
            animation-play-state: paused;
        }

        /* Toast Types */
        .toast-success {
            border-left-color: #48bb78;
        }
        .toast-success .toast-icon {
            color: #48bb78;
        }
        .toast-success .toast-progress {
            background: #48bb78;
        }

        .toast-error {
            border-left-color: #f56565;
        }
        .toast-error .toast-icon {
            color: #f56565;
        }
        .toast-error .toast-progress {
            background: #f56565;
        }

        .toast-warning {
            border-left-color: #ed8936;
        }
        .toast-warning .toast-icon {
            color: #ed8936;
        }
        .toast-warning .toast-progress {
            background: #ed8936;
        }

        .toast-info {
            border-left-color: #4299e1;
        }
        .toast-info .toast-icon {
            color: #4299e1;
        }
        .toast-info .toast-progress {
            background: #4299e1;
        }

        /* ===== Scene Outline Panel ===== */
        .scene-outline-panel {
            width: 220px;
            min-width: 180px;
            max-width: 300px;
            height: 100%;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            z-index: 5;
        }
        .outline-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .outline-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .outline-title i { color: var(--accent-primary); font-size: 11px; }
        .outline-close-btn {
            background: none; border: none; color: var(--text-secondary);
            cursor: pointer; padding: 2px 6px; border-radius: 4px; font-size: 12px;
        }
        .outline-close-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .outline-tree {
            flex: 1;
            overflow-y: auto;
            padding: 6px 0;
            font-size: 12px;
        }
        .outline-empty {
            display: flex; align-items: center; justify-content: center; gap: 6px;
            height: 100%; color: var(--text-secondary); font-size: 12px;
        }
        .outline-empty i { color: var(--text-secondary); }
        .outline-scene {
            padding: 0;
        }
        .outline-scene-header {
            display: flex; align-items: center; gap: 6px;
            padding: 5px 10px; cursor: pointer; color: #e5c07b; font-weight: 600;
            transition: background 0.15s;
        }
        .outline-scene-header:hover { background: var(--bg-secondary); }
        .outline-scene-header i { font-size: 10px; color: var(--text-secondary); transition: transform 0.15s; }
        .outline-scene-header.collapsed i { transform: rotate(-90deg); }
        .outline-scene-icon { color: #c678dd; font-size: 11px; }
        .outline-children {
            padding-left: 12px;
        }
        .outline-children.hidden { display: none; }
        .outline-method {
            display: flex; align-items: center; gap: 6px;
            padding: 3px 10px 3px 18px; cursor: pointer; color: #61afef;
            transition: background 0.15s;
        }
        .outline-method:hover { background: var(--bg-secondary); }
        .outline-method i { font-size: 10px; color: #56b6c2; }
        .outline-mobject {
            display: flex; align-items: center; gap: 6px;
            padding: 3px 10px 3px 30px; cursor: pointer; color: #98c379;
            font-size: 11px; transition: background 0.15s;
        }
        .outline-mobject:hover { background: var(--bg-secondary); }
        .outline-mobject i { font-size: 9px; color: #d19a66; }

        /* ===== Keyboard Shortcuts Modal ===== */
        .shortcut-map-modal {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 10001;
            display: flex; align-items: center; justify-content: center;
        }
        .shortcut-map-content {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 600px; max-width: 90vw; max-height: 80vh;
            display: flex; flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .shortcut-map-header {
            display: flex; align-items: center; gap: 12px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .shortcut-map-header h2 {
            font-size: 16px; font-weight: 600; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px; margin: 0; white-space: nowrap;
        }
        .shortcut-map-header h2 i { color: var(--accent-primary); }
        .shortcut-search-wrap {
            flex: 1; display: flex; align-items: center; gap: 8px;
            background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 6px; padding: 6px 10px;
        }
        .shortcut-search-wrap i { color: var(--text-secondary); font-size: 12px; }
        .shortcut-search-wrap input {
            flex: 1; background: none; border: none; outline: none;
            color: var(--text-primary); font-size: 13px;
        }
        .shortcut-map-close {
            background: none; border: none; color: var(--text-secondary);
            cursor: pointer; padding: 6px 10px; border-radius: 6px; font-size: 14px;
        }
        .shortcut-map-close:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .shortcut-map-body {
            flex: 1; overflow-y: auto; padding: 16px 20px;
        }
        .shortcut-group {
            margin-bottom: 20px;
        }
        .shortcut-group h3 {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1px; color: var(--accent-primary);
            margin: 0 0 8px 0; padding-bottom: 6px;
            border-bottom: 1px solid var(--border-color);
        }
        .shortcut-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 6px 8px; border-radius: 4px;
            transition: background 0.15s;
        }
        .shortcut-row:hover { background: var(--bg-secondary); }
        .shortcut-row.hidden { display: none; }
        .shortcut-desc {
            font-size: 13px; color: var(--text-primary);
        }
        .shortcut-row kbd {
            display: inline-block;
            padding: 2px 7px;
            font-size: 11px;
            font-family: inherit;
            color: var(--text-primary);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            min-width: 20px;
            text-align: center;
        }

        /* monacoEditor fills remaining space in the column */
        .editor-main-col #monacoEditor {
            flex: 1;
            min-width: 0;
        }

        /* ===== Command Palette ===== */
        .command-palette-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.45);
            z-index: 10002;
            display: flex; justify-content: center;
            padding-top: 12vh;
        }
        .command-palette-box {
            width: 540px; max-width: 90vw;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 16px 48px rgba(0,0,0,0.5);
            overflow: hidden;
            display: flex; flex-direction: column;
            max-height: 420px;
        }
        .command-palette-input-wrap {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        .command-palette-input-wrap i { color: var(--accent-primary); font-size: 14px; }
        .command-palette-input-wrap input {
            flex: 1; background: none; border: none; outline: none;
            color: var(--text-primary); font-size: 15px; font-family: inherit;
        }
        .command-palette-results {
            flex: 1; overflow-y: auto; padding: 4px 0;
        }
        .cmd-item {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 16px; cursor: pointer;
            transition: background 0.1s;
        }
        .cmd-item:hover, .cmd-item.active {
            background: var(--accent-primary);
            color: #fff;
        }
        .cmd-item:hover .cmd-shortcut, .cmd-item.active .cmd-shortcut { color: rgba(255,255,255,0.7); }
        .cmd-item i { width: 18px; text-align: center; font-size: 13px; color: var(--text-secondary); }
        .cmd-item:hover i, .cmd-item.active i { color: #fff; }
        .cmd-label { flex: 1; font-size: 13px; color: var(--text-primary); }
        .cmd-item:hover .cmd-label, .cmd-item.active .cmd-label { color: #fff; }
        .cmd-shortcut { font-size: 11px; color: var(--text-secondary); }
        .cmd-empty { padding: 20px; text-align: center; color: var(--text-secondary); font-size: 13px; }

        /* ===== Zen Mode ===== */
        body.zen-mode .header,
        body.zen-mode .tab-header,
        body.zen-mode .workspace-bottom,
        body.zen-mode .workspace-divider-h,
        body.zen-mode .workspace-preview,
        body.zen-mode .workspace-divider-v,
        body.zen-mode .workspace-controls-sidebar,
        body.zen-mode .sidebar-float-toggle,
        body.zen-mode .status-bar,
        body.zen-mode .code-errors-panel,
        body.zen-mode #sceneOutlinePanel {
            display: none !important;
        }
        body.zen-mode .workspace-editor {
            flex: 1 !important;
            max-width: 100% !important;
        }
        body.zen-mode .workspace-top {
            flex: 1 !important;
        }
        body.zen-mode .app-container,
        body.zen-mode .layout,
        body.zen-mode .content,
        body.zen-mode .tab-panel,
        body.zen-mode .workspace-container,
        body.zen-mode .workspace-main-content {
            height: 100vh !important;
        }
        /* Zen mode exit hint */
        .zen-exit-hint {
            position: fixed; top: 12px; right: 12px;
            background: rgba(0,0,0,0.7); color: #aaa;
            padding: 6px 14px; border-radius: 6px;
            font-size: 12px; z-index: 100000;
            opacity: 0; transition: opacity 0.3s;
            pointer-events: none;
        }
        body.zen-mode .zen-exit-hint { opacity: 1; }
        body.zen-mode:hover .zen-exit-hint { opacity: 0.4; }

        /* ===== Editor Bookmark Decorations ===== */
        .bookmark-glyph {
            background: #3b82f6 !important;
            width: 6px !important;
            height: 6px !important;
            border-radius: 50%;
            margin-left: 4px;
            margin-top: 7px;
        }
        .bookmark-line {
            background: rgba(59, 130, 246, 0.06);
        }

        /* ===== Drag-Drop Overlay ===== */
        .dragdrop-overlay {
            position: absolute; inset: 0;
            background: rgba(59, 130, 246, 0.15);
            border: 3px dashed #3b82f6;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            z-index: 100; pointer-events: none;
        }
        .dragdrop-overlay span {
            background: rgba(0,0,0,0.7); color: #fff;
            padding: 12px 24px; border-radius: 8px;
            font-size: 15px; font-weight: 600;
        }

        /* ===== AI Edit Panel (right side, mirrors outline panel) ===== */
        .ai-edit-panel {
            width: 280px;
            min-width: 240px;
            max-width: 380px;
            height: 100%;
            background: var(--bg-primary);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            z-index: 5;
        }
        .ai-edit-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .ai-edit-panel-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .ai-edit-panel-title i { color: #a78bfa; font-size: 11px; }
        .ai-edit-panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .ai-edit-context {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        .ai-edit-context i { color: #61afef; font-size: 10px; }
        .ai-edit-context.has-selection { color: #e5c07b; }
        .ai-edit-context.has-selection i { color: #e5c07b; }
        .ai-edit-section { display: flex; flex-direction: column; gap: 4px; }
        .ai-edit-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .ai-edit-textarea {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 10px;
            color: var(--text-primary);
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            outline: none;
            line-height: 1.5;
        }
        .ai-edit-textarea:focus { border-color: #a78bfa; }
        .ai-edit-select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px 8px;
            color: var(--text-primary);
            font-size: 12px;
            outline: none;
            cursor: pointer;
        }
        .ai-edit-send-btn {
            background: linear-gradient(135deg, #a78bfa, #7c3aed);
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: opacity 0.2s;
        }
        .ai-edit-send-btn:hover { opacity: 0.9; }
        .ai-edit-send-btn:disabled { opacity: 0.5; cursor: wait; }
        .ai-edit-send-btn.cancel-mode {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .ai-edit-status {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 0;
        }
        .ai-edit-diff-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-top: 6px;
            border-top: 1px solid var(--border-color);
        }
        .ai-edit-diff-header {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .ai-edit-diff-stats {
            font-size: 11px;
            color: var(--text-secondary);
        }
        .ai-edit-accept-btn {
            background: #10b981;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 7px 14px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: opacity 0.2s;
        }
        .ai-edit-accept-btn:hover { opacity: 0.9; }
        .ai-edit-reject-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 7px 14px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }
        .ai-edit-reject-btn:hover { background: var(--bg-secondary); }
        .ai-edit-stream-box { display: flex; flex-direction: column; gap: 4px; }
        .ai-edit-stream-output {
            background: #1e1e1e;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 10px;
            color: #d4d4d4;
            font-size: 11px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            margin: 0;
        }
        /* Diff container overlays the editor area when showing diff */
        #aiDiffContainer {
            position: absolute; inset: 0; z-index: 50;
        }

        /* ===== Manim Docs Panel ===== */
        .manim-docs-panel {
            position: fixed; right: 0; top: 0; bottom: 0;
            width: 360px; max-width: 45vw;
            background: var(--bg-primary);
            border-left: 1px solid var(--border-color);
            z-index: 9999;
            display: flex; flex-direction: column;
            box-shadow: -4px 0 20px rgba(0,0,0,0.3);
            transform: translateX(100%);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .manim-docs-panel.open { transform: translateX(0); }
        .docs-header {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 14px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .docs-header h3 {
            font-size: 14px; font-weight: 600; color: var(--text-primary);
            display: flex; align-items: center; gap: 6px; margin: 0; flex: 1;
        }
        .docs-header h3 i { color: #f59e0b; }
        .docs-close-btn {
            background: none; border: none; color: var(--text-secondary);
            cursor: pointer; padding: 4px 8px; border-radius: 4px; font-size: 14px;
        }
        .docs-close-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .docs-search-wrap {
            padding: 8px 14px;
            border-bottom: 1px solid var(--border-color);
        }
        .docs-search-wrap input {
            width: 100%; background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 6px; padding: 7px 10px; color: var(--text-primary);
            font-size: 13px; outline: none; box-sizing: border-box;
        }
        .docs-search-wrap input:focus { border-color: #f59e0b; }
        .docs-body {
            flex: 1; overflow-y: auto; padding: 14px;
        }
        .docs-empty {
            text-align: center; color: var(--text-secondary); padding: 30px 10px; font-size: 13px;
        }
        .docs-empty i { font-size: 28px; color: var(--text-secondary); display: block; margin-bottom: 10px; }
        .docs-class-name {
            font-size: 16px; font-weight: 700; color: #e5c07b;
            margin-bottom: 6px; font-family: 'Consolas', monospace;
        }
        .docs-signature {
            font-size: 12px; color: #61afef; font-family: 'Consolas', monospace;
            background: var(--bg-secondary); padding: 8px 10px; border-radius: 6px;
            margin-bottom: 10px; line-height: 1.5; white-space: pre-wrap;
        }
        .docs-description {
            font-size: 13px; color: var(--text-primary); line-height: 1.6; margin-bottom: 12px;
        }
        .docs-description code {
            background: var(--bg-tertiary); padding: 1px 5px; border-radius: 3px;
            font-family: 'Consolas', monospace; font-size: 12px; color: #ce9178;
        }
        .docs-params-title {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.8px; color: var(--accent-primary); margin-bottom: 6px;
        }
        .docs-param {
            padding: 6px 8px; margin-bottom: 4px;
            background: var(--bg-secondary); border-radius: 4px; font-size: 12px;
        }
        .docs-param-name { color: #e06c75; font-weight: 600; font-family: 'Consolas', monospace; }
        .docs-param-desc { color: var(--text-secondary); margin-top: 2px; }
        .docs-example-title {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.8px; color: #10b981; margin: 12px 0 6px 0;
        }
        .docs-example {
            background: #1e1e1e; border: 1px solid var(--border-color);
            border-radius: 6px; padding: 10px; font-family: 'Consolas', monospace;
            font-size: 12px; color: #d4d4d4; white-space: pre; line-height: 1.5;
            overflow-x: auto; cursor: pointer; position: relative;
        }
        .docs-example:hover::after {
            content: 'Click to insert'; position: absolute; top: 4px; right: 6px;
            font-size: 10px; color: #10b981; background: rgba(0,0,0,0.7);
            padding: 2px 6px; border-radius: 3px;
        }
        .docs-browse-item {
            padding: 8px 10px; border-radius: 6px; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
            transition: background 0.15s; margin-bottom: 2px;
        }
        .docs-browse-item:hover { background: var(--bg-secondary); }
        .docs-browse-item .item-name { color: #e5c07b; font-weight: 600; font-size: 13px; font-family: 'Consolas', monospace; }
        .docs-browse-item .item-type { color: var(--text-secondary); font-size: 11px; margin-left: auto; }
    </style>
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>
    <!-- Zen Mode Exit Hint -->
    <div class="zen-exit-hint">Press F11 or Esc to exit Zen Mode</div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">ðŸŽ¬</div>
            <div class="title-section">
                <h1 class="app-title">Manim Animation Studio</h1>
                <span class="app-subtitle">Professional Edition <span id="appVersion">v1.1.1.0</span></span>
            </div>
            <div class="autosave-indicator" id="autosaveIndicator">
                <i class="fas fa-check-circle"></i>
                <span id="autosaveStatus">Saved</span>
            </div>
        </div>

        <div class="header-center">
            <button class="action-btn" id="newFileBtn" title="New File">
                <i class="fas fa-file"></i>
                <span>New</span>
            </button>
            <button class="action-btn" id="openFileBtn" title="Open File">
                <i class="fas fa-folder-open"></i>
                <span>Open</span>
            </button>
            <button class="action-btn" id="saveFileBtn" title="Save File">
                <i class="fas fa-save"></i>
                <span>Save</span>
            </button>
            <div class="divider"></div>
            <button class="action-btn primary" id="renderBtn" title="Render Animation (F5)">
                <i class="fas fa-play"></i>
                <span>Render</span>
            </button>
            <button class="action-btn" id="previewBtn" title="Quick Preview (F6)">
                <i class="fas fa-eye"></i>
                <span>Preview</span>
            </button>
            <button class="action-btn danger" id="stopBtn" title="Stop Render" style="display: none;">
                <i class="fas fa-stop"></i>
                <span>Stop</span>
            </button>
            <div class="divider"></div>
            <button class="action-btn" id="gpuToggleBtn" title="Toggle GPU Acceleration (OpenGL Renderer)">
                <i class="fas fa-microchip"></i>
                <span id="gpuToggleText">GPU: OFF</span>
            </button>
            <button class="action-btn" id="colorPickerBtn" title="Manim Color Palette">
                <i class="fas fa-palette"></i>
                <span>Colors</span>
            </button>
        </div>

        <div class="header-right">
            <button class="status-btn" id="latexStatusBtn" title="LaTeX Status - Checking...">
                <span class="status-dot checking"></span>
                <span class="status-text">LaTeX</span>
            </button>
            <button class="icon-btn" id="settingsBtn" title="Settings">
                <i class="fas fa-cog"></i>
            </button>
            <button class="icon-btn" id="themeBtn" title="Toggle Theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="icon-btn" id="helpBtn" title="Help">
                <i class="fas fa-question-circle"></i>
            </button>
        </div>
    </header>

    <div class="app-container">
        <div class="layout">
            <section class="content">
                <div class="tab-header">
                    <button class="tab-pill active" data-tab="workspace"><i class="fas fa-desktop"></i> Workspace</button>
                    <button class="tab-pill" data-tab="system"><i class="fas fa-info-circle"></i> System</button>
                    <button class="tab-pill" data-tab="assets"><i class="fas fa-images"></i> Assets</button>
                    <button class="tab-pill" data-tab="venv"><i class="fas fa-box"></i> Packages</button>
                    <button class="tab-pill" data-tab="history"><i class="fas fa-clock-rotate-left"></i> History</button>
                </div>

                <div class="tab-panel active" id="workspace-panel">
                    <div class="workspace-container">
                        <!-- Main Content Area -->
                        <div class="workspace-main-content">
                        <!-- Top Section: Editor and Preview Side by Side -->
                        <div class="workspace-top" id="workspaceTop">
                            <!-- Code Editor -->
                            <div class="workspace-editor" id="workspaceEditor">
                                <div class="workspace-header">
                                    <h2><i class="fas fa-code"></i> Code Editor</h2>
                                    <div class="workspace-tools">
                                        <button class="icon-btn small" id="sceneOutlineBtn" title="Scene Outline (Ctrl+Shift+O)">
                                            <i class="fas fa-sitemap"></i>
                                        </button>
                                        <button class="icon-btn small" id="aiEditPanelBtn" title="AI Edit (Ctrl+Shift+E)" style="color:#a78bfa;">
                                            <i class="fas fa-wand-magic-sparkles"></i>
                                        </button>
                                        <button class="icon-btn small" id="findReplaceBtn" title="Find & Replace (Ctrl+H)">
                                            <i class="fas fa-search"></i>
                                        </button>
                                        <button class="icon-btn small" id="shortcutMapBtn" title="Keyboard Shortcuts (Ctrl+/)">
                                            <i class="fas fa-keyboard"></i>
                                        </button>
                                        <label class="workspace-control">
                                            <span>Font Size</span>
                                            <select id="fontSizeSelect">
                                                <option value="12">12px</option>
                                                <option value="14" selected>14px</option>
                                                <option value="16">16px</option>
                                                <option value="18">18px</option>
                                                <option value="20">20px</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                <div class="workspace-body">
                                    <!-- Scene Outline Panel -->
                                    <div id="sceneOutlinePanel" class="scene-outline-panel" style="display:none;">
                                        <div class="outline-header">
                                            <span class="outline-title"><i class="fas fa-sitemap"></i> Outline</span>
                                            <button class="outline-close-btn" id="closeOutlineBtn" title="Close"><i class="fas fa-times"></i></button>
                                        </div>
                                        <div id="outlineTree" class="outline-tree">
                                            <div class="outline-empty"><i class="fas fa-code"></i> No scenes found</div>
                                        </div>
                                    </div>
                                    <div class="editor-main-col">
                                        <div id="monacoEditor" style="flex:1;width:100%;min-height:0;"></div>
                                        <!-- Live Code Errors Panel (hidden by default, shows when errors detected) -->
                                        <div id="codeErrorsPanel" class="code-errors-panel" style="display: none;">
                                            <div class="errors-header">
                                                <span class="errors-title">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                    Code Issues (<span id="errorCount">0</span>)
                                                </span>
                                                <div style="display:flex;gap:4px;align-items:center;">
                                                    <button id="fixWithAIBtn" class="errors-clear-btn" title="Fix errors with AI (Claude)" style="color:#a78bfa;">
                                                        <i class="fas fa-wand-magic-sparkles"></i> Fix with AI
                                                    </button>
                                                    <button id="clearErrorsBtn" class="errors-clear-btn" title="Clear errors">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="errorsList" class="errors-list">
                                                <div class="errors-empty">
                                                    <i class="fas fa-check-circle"></i>
                                                    No issues found
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- AI Edit Panel (right side, like outline on left) -->
                                    <div id="aiEditPanel" class="ai-edit-panel" style="display:none;">
                                        <div class="ai-edit-panel-header">
                                            <span class="ai-edit-panel-title"><i class="fas fa-wand-magic-sparkles"></i> AI Edit</span>
                                            <button class="outline-close-btn" id="aiEditPanelClose" title="Close (Esc)"><i class="fas fa-times"></i></button>
                                        </div>
                                        <div class="ai-edit-panel-body">
                                            <!-- Context indicator -->
                                            <div id="aiEditContext" class="ai-edit-context">
                                                <i class="fas fa-file-code"></i> <span id="aiEditContextText">Editing whole file</span>
                                            </div>
                                            <!-- Prompt Section -->
                                            <div class="ai-edit-section">
                                                <label class="ai-edit-label">Prompt</label>
                                                <textarea id="aiEditPrompt" class="ai-edit-textarea" rows="4" placeholder="Describe the edit you want Claude to make..."></textarea>
                                            </div>
                                            <!-- Model Selector -->
                                            <div class="ai-edit-section">
                                                <label class="ai-edit-label">Model</label>
                                                <select id="aiEditModelSelect" class="ai-edit-select">
                                                    <option value="">Default</option>
                                                </select>
                                            </div>
                                            <!-- Send / Cancel -->
                                            <button id="aiEditSendBtn" class="ai-edit-send-btn">
                                                <i class="fas fa-paper-plane"></i> Send to Claude
                                            </button>
                                            <!-- Status -->
                                            <div id="aiEditStatusText" class="ai-edit-status" style="display:none;">
                                                <i class="fas fa-circle-notch fa-spin" style="color:#a78bfa;"></i>
                                                <span id="aiEditStatusMsg">Working...</span>
                                            </div>
                                            <!-- Streaming Output Preview -->
                                            <div id="aiEditStreamBox" class="ai-edit-stream-box" style="display:none;">
                                                <label class="ai-edit-label">Output</label>
                                                <pre id="aiEditStreamOutput" class="ai-edit-stream-output"></pre>
                                            </div>
                                            <!-- Diff Review (shown when diff is ready) -->
                                            <div id="aiDiffActions" class="ai-edit-diff-actions" style="display:none;">
                                                <div class="ai-edit-diff-header">
                                                    <i class="fas fa-code-compare" style="color:#10b981;"></i>
                                                    <span>Review Changes</span>
                                                </div>
                                                <span id="aiDiffStats" class="ai-edit-diff-stats"></span>
                                                <button id="aiDiffAccept" class="ai-edit-accept-btn">
                                                    <i class="fas fa-check"></i> Accept All
                                                </button>
                                                <button id="aiDiffReject" class="ai-edit-reject-btn">
                                                    <i class="fas fa-times"></i> Reject All
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Vertical Resize Handle -->
                            <div class="workspace-divider-v" id="verticalResizeHandle"></div>

                            <!-- Preview Panel -->
                            <div class="workspace-preview" id="workspacePreview">
                                <!-- Header -->
                                <div class="workspace-header">
                                    <h2><i class="fas fa-play-circle"></i> Preview</h2>
                                    <div class="workspace-tools">
                                        <button class="icon-btn small" id="screenshotBtn" title="Screenshot current frame (Ctrl+Shift+S)">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Preview Viewport Container -->
                                <div class="workspace-body">
                                    <!-- File Info Bar -->
                                    <div class="preview-info-bar">
                                        <div class="preview-file-details">
                                            <i class="fas fa-file-video"></i>
                                            <span id="previewFilename">No preview</span>
                                            <span class="preview-file-size" id="previewFilesize"></span>
                                        </div>
                                    </div>

                                    <!-- Video/Image Viewport -->
                                    <div class="preview-viewport" id="previewContainer">
                                        <div class="preview-media-container">
                                            <video id="previewVideo" class="preview-media" controls style="display:none;"></video>
                                            <img id="previewImage" class="preview-media" alt="Preview" style="display:none;">

                                            <!-- Placeholder -->
                                            <div class="preview-placeholder">
                                                <div class="preview-placeholder-icon">
                                                    <i class="fas fa-film"></i>
                                                </div>
                                                <h3>No Preview</h3>
                                                <p>Render or preview an animation</p>
                                                <div class="preview-placeholder-hint">
                                                    <i class="fas fa-info-circle"></i>
                                                    <span>Videos will auto-load here</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Horizontal Resize Handle -->
                        <div class="workspace-divider-h" id="horizontalResizeHandle"></div>

                        <!-- Bottom Section: Unified Console & Terminal -->
                        <div class="workspace-bottom" id="workspaceBottom">
                            <div class="workspace-header">
                                <h2><i class="fas fa-terminal"></i> Console & Terminal</h2>
                                <div class="workspace-tools">
                                    <span class="terminal-status-label">Status: <span id="terminalStatus">Ready</span></span>
                                    <button class="icon-btn small" id="copyOutputBtn" title="Copy Terminal Output">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button class="icon-btn small" id="clearOutputBtn" title="Clear Console">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="workspace-body" style="padding: 0;">
                                <!-- xterm.js Terminal Container -->
                                <div id="terminalContainer" style="width: 100%; height: 100%; background: #0c0c0c; padding: 8px; box-sizing: border-box;"></div>
                            </div>
                        </div>
                        </div>
                        <!-- End workspace-main-content -->

                        <!-- Floating Sidebar Toggle Button (shows when sidebar is hidden) -->
                        <button class="sidebar-float-toggle" id="sidebarOpenBtn" title="Open render controls">
                            <i class="fas fa-sliders-h"></i>
                        </button>

                        <!-- Controls Sidebar -->
                        <div class="workspace-controls-sidebar" id="controlsSidebar">
                            <div class="sidebar-header">
                                <i class="fas fa-sliders-h"></i>
                                <h3>Render Controls</h3>
                                <button class="sidebar-toggle-btn" id="sidebarCloseBtn" title="Close sidebar">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <!-- Preview Settings Section -->
                            <div class="sidebar-section">
                                <div class="sidebar-section-header">
                                    <i class="fas fa-eye"></i>
                                    <span>Quick Preview</span>
                                </div>
                                <div class="sidebar-section-body">
                                    <div class="sidebar-control">
                                        <label>Quality</label>
                                        <select id="previewQualitySelect">
                                            <option value="120p">120p</option>
                                            <option value="240p">240p</option>
                                            <option value="480p" selected>480p</option>
                                            <option value="720p">720p</option>
                                            <option value="1080p">1080p</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                    <div class="sidebar-control" id="previewCustomResolutionDiv" style="display: none;">
                                        <label>Width</label>
                                        <input type="text" id="previewCustomWidth" placeholder="1920" value="1920">
                                        <label style="margin-top: 8px;">Height</label>
                                        <input type="text" id="previewCustomHeight" placeholder="1080" value="1080">
                                    </div>
                                    <div class="sidebar-control">
                                        <label>FPS</label>
                                        <select id="previewFpsSelect">
                                            <option value="15" selected>15</option>
                                            <option value="24">24</option>
                                            <option value="30">30</option>
                                            <option value="60">60</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                    <div class="sidebar-control" id="previewCustomFpsDiv" style="display: none;">
                                        <label>Custom FPS</label>
                                        <input type="text" id="previewCustomFps" placeholder="30" value="30">
                                    </div>
                                </div>
                            </div>

                            <!-- Render Settings Section -->
                            <div class="sidebar-section">
                                <div class="sidebar-section-header">
                                    <i class="fas fa-film"></i>
                                    <span>Final Render</span>
                                </div>
                                <div class="sidebar-section-body">
                                    <div class="sidebar-control">
                                        <label>Quality</label>
                                        <select id="qualitySelect">
                                            <option value="8K">8K</option>
                                            <option value="4K">4K</option>
                                            <option value="1440p">1440p</option>
                                            <option value="1080p">1080p</option>
                                            <option value="720p" selected>720p</option>
                                            <option value="480p">480p</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                    <div class="sidebar-control" id="customResolutionDiv" style="display: none;">
                                        <label>Width</label>
                                        <input type="text" id="customWidth" placeholder="1920" value="1920">
                                        <label style="margin-top: 8px;">Height</label>
                                        <input type="text" id="customHeight" placeholder="1080" value="1080">
                                    </div>
                                    <div class="sidebar-control">
                                        <label>FPS</label>
                                        <select id="fpsSelect">
                                            <option value="24">24</option>
                                            <option value="30" selected>30</option>
                                            <option value="60">60</option>
                                            <option value="120">120</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                    <div class="sidebar-control" id="customFpsDiv" style="display: none;">
                                        <label>Custom FPS</label>
                                        <input type="text" id="customFps" placeholder="30" value="30">
                                    </div>
                                    <div class="sidebar-control">
                                        <label>Format</label>
                                        <select id="formatSelect">
                                            <option value="mp4" selected>MP4</option>
                                            <option value="mov">MOV</option>
                                            <option value="gif">GIF</option>
                                            <option value="png">PNG</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End controls sidebar -->
                    </div>
                </div>

                <div class="tab-panel" id="system-panel">
                    <div class="panel-heading">
                        <h2><i class="fas fa-info-circle"></i> System Overview</h2>
                        <button class="small-btn" id="refreshSystemBtn">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    <div class="info-grid" id="systemInfo">
                        <div class="info-card">
                            <h4>Python Version</h4>
                            <p id="pythonVersion">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Manim Version</h4>
                            <p id="manimVersion">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Platform</h4>
                            <p id="platform">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Virtual Environment</h4>
                            <p id="venvPath">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Python Executable</h4>
                            <p id="pythonExe">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Media Directory</h4>
                            <p id="mediaDir">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Project Root</h4>
                            <p id="baseDir">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Environment Status</h4>
                            <p id="venvStatus">-</p>
                        </div>
                        <div class="info-card">
                            <h4>Manim Status</h4>
                            <p id="manimStatus">-</p>
                        </div>
                        <div class="info-card" id="latexStatusCard">
                            <h4>ðŸ“„ LaTeX Status</h4>
                            <p id="latexStatus" style="display: flex; align-items: center; gap: 8px;">
                                <span class="status-indicator checking"></span>
                                <span>Checking...</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ASSETS TAB - Modern Design -->
                <div class="tab-panel" id="assets-panel">
                    <style>
                        /* Assets Tab - Premium Glassmorphism Design */
                        .assets-container {
                            display: flex;
                            flex-direction: column;
                            height: 100%;
                            background: linear-gradient(135deg, #0a0a0f 0%, #12121a 100%);
                            padding: 20px;
                            gap: 20px;
                            overflow: hidden;
                        }

                        /* Header with actions */
                        .assets-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            animation: slideInDown 0.4s ease-out;
                        }

                        .assets-title {
                            font-size: 28px;
                            font-weight: 600;
                            color: var(--text-primary);
                            display: flex;
                            align-items: center;
                            gap: 12px;
                        }

                        .assets-title i {
                            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                            font-size: 32px;
                        }

                        .assets-actions {
                            display: flex;
                            gap: 12px;
                        }

                        .assets-btn {
                            padding: 10px 20px;
                            background: rgba(99, 102, 241, 0.12);
                            border: 1px solid rgba(99, 102, 241, 0.25);
                            border-radius: 8px;
                            color: #6366f1;
                            font-size: 14px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }

                        .assets-btn:hover {
                            background: rgba(99, 102, 241, 0.2);
                            border-color: rgba(99, 102, 241, 0.45);
                            transform: translateY(-2px);
                            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.35);
                        }

                        /* Drag and Drop Upload Zone - Premium */
                        .assets-dropzone {
                            background: rgba(99, 102, 241, 0.03);
                            backdrop-filter: blur(12px);
                            border: 2px dashed rgba(99, 102, 241, 0.25);
                            border-radius: 12px;
                            padding: 16px 24px;
                            display: flex;
                            align-items: center;
                            gap: 16px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            position: relative;
                            overflow: hidden;
                        }

                        .assets-dropzone::before {
                            content: '';
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: linear-gradient(90deg, rgba(99, 102, 241, 0.08) 0%, rgba(168, 85, 247, 0.05) 100%);
                            opacity: 0;
                            transition: opacity 0.3s ease;
                        }

                        .assets-dropzone:hover::before {
                            opacity: 1;
                        }

                        .assets-dropzone:hover {
                            border-color: rgba(99, 102, 241, 0.5);
                            background: rgba(99, 102, 241, 0.06);
                        }

                        .assets-dropzone.dragover {
                            border-color: #6366f1;
                            background: rgba(99, 102, 241, 0.1);
                            box-shadow: 0 0 25px rgba(99, 102, 241, 0.25);
                        }

                        .assets-dropzone.dragover::before {
                            opacity: 1;
                        }

                        .dropzone-icon {
                            font-size: 32px;
                            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                            flex-shrink: 0;
                        }

                        .dropzone-content {
                            flex: 1;
                            text-align: left;
                        }

                        .dropzone-text {
                            font-size: 15px;
                            font-weight: 600;
                            color: var(--text-primary);
                            margin-bottom: 4px;
                        }

                        .dropzone-hint {
                            font-size: 12px;
                            color: var(--text-secondary);
                        }

                        /* Main content area */
                        .assets-content {
                            display: flex;
                            gap: 20px;
                            flex: 1;
                            min-height: 0;
                        }

                        /* Files table/column view */
                        .assets-files {
                            flex: 1;
                            overflow-y: auto;
                            background: rgba(255, 255, 255, 0.03);
                            backdrop-filter: blur(10px);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 12px;
                            padding: 0;
                        }

                        .assets-table {
                            width: 100%;
                        }

                        /* Table header */
                        .assets-table-header {
                            display: flex;
                            align-items: center;
                            padding: 16px 20px;
                            background: rgba(255, 255, 255, 0.05);
                            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                            position: sticky;
                            top: 0;
                            z-index: 10;
                            backdrop-filter: blur(10px);
                        }

                        .assets-table-header > div {
                            font-size: 11px;
                            font-weight: 700;
                            color: var(--text-secondary);
                            text-transform: uppercase;
                            letter-spacing: 1px;
                        }

                        /* Table row */
                        .asset-row {
                            display: flex;
                            align-items: center;
                            padding: 12px 20px;
                            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                            cursor: pointer;
                            transition: all 0.2s ease;
                            position: relative;
                        }

                        .asset-row::before {
                            content: '';
                            position: absolute;
                            left: 0;
                            top: 0;
                            bottom: 0;
                            width: 3px;
                            background: var(--asset-color);
                            opacity: 0;
                            transition: opacity 0.2s ease;
                        }

                        .asset-row:hover {
                            background: rgba(255, 255, 255, 0.05);
                        }

                        .asset-row:hover::before {
                            opacity: 1;
                        }

                        .asset-row.video { --asset-color: #3b82f6; }
                        .asset-row.image { --asset-color: #10b981; }
                        .asset-row.audio { --asset-color: #8b5cf6; }
                        .asset-row.font { --asset-color: #f59e0b; }

                        /* Column widths */
                        .asset-col-preview {
                            width: 50px;
                            flex-shrink: 0;
                        }

                        .asset-col-name {
                            flex: 1;
                            min-width: 200px;
                            padding-right: 16px;
                        }

                        .asset-col-type {
                            width: 140px;
                            flex-shrink: 0;
                        }

                        .asset-col-size {
                            width: 100px;
                            flex-shrink: 0;
                        }

                        .asset-col-actions {
                            width: 180px;
                            flex-shrink: 0;
                            text-align: right;
                        }

                        /* Preview thumbnail/icon */
                        .asset-preview {
                            width: 40px;
                            height: 40px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: rgba(0, 0, 0, 0.3);
                            border-radius: 6px;
                            font-size: 20px;
                            color: var(--asset-color);
                        }

                        .asset-thumbnail {
                            width: 40px;
                            height: 40px;
                            object-fit: cover;
                            border-radius: 6px;
                        }

                        /* Name column */
                        .asset-name {
                            font-size: 14px;
                            font-weight: 600;
                            color: var(--text-primary);
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                        }

                        /* Type column */
                        .asset-type {
                            font-size: 12px;
                            color: var(--text-secondary);
                        }

                        /* Size column */
                        .asset-size {
                            font-size: 12px;
                            color: var(--text-secondary);
                        }

                        /* Actions column */
                        .asset-actions {
                            display: flex;
                            gap: 8px;
                            justify-content: flex-end;
                        }

                        .asset-action-btn {
                            padding: 6px 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 6px;
                            color: var(--text-primary);
                            font-size: 11px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                            display: flex;
                            align-items: center;
                            gap: 4px;
                        }

                        .asset-action-btn:hover {
                            background: rgba(255, 255, 255, 0.1);
                            border-color: rgba(255, 255, 255, 0.2);
                            transform: translateY(-1px);
                        }

                        .asset-action-btn.delete {
                            color: #ef4444;
                        }

                        .asset-action-btn.delete:hover {
                            background: rgba(239, 68, 68, 0.2);
                            border-color: rgba(239, 68, 68, 0.5);
                        }

                        /* Preview panel */
                        .assets-preview {
                            flex: 0 0 400px;
                            background: rgba(255, 255, 255, 0.03);
                            backdrop-filter: blur(10px);
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            border-radius: 12px;
                            padding: 20px;
                            display: flex;
                            flex-direction: column;
                            gap: 16px;
                        }

                        .preview-header {
                            display: flex;
                            align-items: center;
                            gap: 12px;
                            padding-bottom: 16px;
                            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                        }

                        .preview-header i {
                            font-size: 24px;
                            color: #3b82f6;
                        }

                        .preview-header h3 {
                            font-size: 18px;
                            font-weight: 600;
                            color: var(--text-primary);
                            margin: 0;
                        }

                        .preview-content {
                            flex: 1;
                            background: rgba(0, 0, 0, 0.3);
                            border-radius: 8px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            overflow: hidden;
                            position: relative;
                        }

                        .preview-placeholder {
                            text-align: center;
                            color: var(--text-secondary);
                        }

                        .preview-placeholder i {
                            font-size: 64px;
                            margin-bottom: 16px;
                            opacity: 0.3;
                        }

                        .preview-info {
                            padding: 12px;
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 8px;
                            font-size: 13px;
                            color: var(--text-secondary);
                            text-align: center;
                            word-break: break-word;
                        }

                        /* Empty state */
                        .assets-empty {
                            text-align: center;
                            padding: 60px 20px;
                            color: var(--text-secondary);
                        }

                        .assets-empty i {
                            font-size: 80px;
                            margin-bottom: 20px;
                            opacity: 0.2;
                        }

                        .assets-empty p {
                            font-size: 16px;
                            margin: 0;
                        }

                        /* Scrollbar styling */
                        .assets-files::-webkit-scrollbar {
                            width: 8px;
                        }

                        .assets-files::-webkit-scrollbar-track {
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 4px;
                        }

                        .assets-files::-webkit-scrollbar-thumb {
                            background: rgba(255, 255, 255, 0.2);
                            border-radius: 4px;
                        }

                        .assets-files::-webkit-scrollbar-thumb:hover {
                            background: rgba(255, 255, 255, 0.3);
                        }
                    </style>

                    <div class="assets-container">
                        <!-- Header -->
                        <div class="assets-header">
                            <div class="assets-title">
                                <i class="fas fa-images"></i>
                                Assets Library
                            </div>
                            <div class="assets-actions">
                                <button class="assets-btn" onclick="window.loadAssets()">
                                    <i class="fas fa-sync"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Drag & Drop Upload Zone -->
                        <div class="assets-dropzone" id="assetsDropzone" onclick="window.uploadAssets()">
                            <div class="dropzone-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="dropzone-content">
                                <div class="dropzone-text">Drag & Drop Files Here</div>
                                <div class="dropzone-hint">or click to browse â€¢ Images, Videos, Audio, Fonts & More</div>
                            </div>
                        </div>

                        <!-- Content Area -->
                        <div class="assets-content">
                            <!-- Files Table -->
                            <div class="assets-files">
                                <div class="assets-table">
                                    <div class="assets-table-header">
                                        <div class="asset-col-preview"></div>
                                        <div class="asset-col-name">Name</div>
                                        <div class="asset-col-type">Type</div>
                                        <div class="asset-col-size">Size</div>
                                        <div class="asset-col-actions">Actions</div>
                                    </div>
                                    <div id="simpleAssetsContainer"></div>
                                </div>
                            </div>

                            <!-- Preview Panel -->
                            <div class="assets-preview">
                                <div class="preview-header">
                                    <i class="fas fa-eye"></i>
                                    <h3>Preview</h3>
                                </div>
                                <div class="preview-content" id="assetsPreviewContainer">
                                    <div class="preview-placeholder">
                                        <i class="fas fa-image"></i>
                                        <p>Select a file to preview</p>
                                    </div>
                                </div>
                                <div class="preview-info" id="assetsPreviewInfo"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Venv/Packages Tab -->
                <div class="tab-panel" id="venv-panel">
                    <div class="venv-container">
                        <div class="venv-header">
                            <h2><i class="fas fa-box"></i> Package Manager</h2>
                            <div class="venv-header-actions">
                                <button class="venv-btn" onclick="refreshPackages(true)" id="checkUpdatesBtn">
                                    <i class="fas fa-download"></i> Check for Updates
                                </button>
                                <button class="venv-btn" onclick="refreshPackages(false)">
                                    <i class="fas fa-sync-alt"></i> Refresh List
                                </button>
                            </div>
                        </div>

                        <!-- Install Package Section -->
                        <div class="venv-install-section">
                            <h3>Install New Package</h3>
                            <div class="venv-install-form">
                                <input
                                    type="text"
                                    id="packageNameInput"
                                    placeholder="Enter package name (e.g., numpy, matplotlib)"
                                    onkeypress="if(event.key === 'Enter') installPackage()"
                                />
                                <button class="venv-btn-primary" onclick="installPackage()">
                                    <i class="fas fa-download"></i> Install
                                </button>
                            </div>
                        </div>

                        <!-- Installed Packages List -->
                        <div class="venv-packages-section">
                            <h3>Installed Packages</h3>
                            <div class="venv-packages-list" id="packagesList">
                                <div class="venv-loading">
                                    <i class="fas fa-spinner fa-spin"></i> Loading packages...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Render History Tab -->
                <div class="tab-panel" id="history-panel">
                    <style>
                        .history-container {
                            display: flex;
                            flex-direction: column;
                            height: 100%;
                            padding: 20px;
                            gap: 16px;
                            overflow: hidden;
                        }
                        .history-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        }
                        .history-title {
                            font-size: 28px;
                            font-weight: 600;
                            color: var(--text-primary);
                            display: flex;
                            align-items: center;
                            gap: 12px;
                        }
                        .history-title i {
                            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                            font-size: 32px;
                        }
                        .history-actions {
                            display: flex;
                            gap: 10px;
                        }
                        .history-btn {
                            padding: 8px 16px;
                            background: rgba(99, 102, 241, 0.12);
                            border: 1px solid rgba(99, 102, 241, 0.25);
                            border-radius: 8px;
                            color: #6366f1;
                            font-size: 13px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                            gap: 6px;
                        }
                        .history-btn:hover { background: rgba(99, 102, 241, 0.2); }
                        .history-btn.danger { color: #ef4444; border-color: rgba(239, 68, 68, 0.25); background: rgba(239, 68, 68, 0.1); }
                        .history-btn.danger:hover { background: rgba(239, 68, 68, 0.2); }

                        .history-list {
                            flex: 1;
                            overflow-y: auto;
                            display: flex;
                            flex-direction: column;
                            gap: 8px;
                        }
                        .history-empty {
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            height: 100%;
                            color: var(--text-secondary);
                            gap: 12px;
                            font-size: 15px;
                        }
                        .history-empty i { font-size: 48px; opacity: 0.3; }

                        .history-entry {
                            display: flex;
                            align-items: center;
                            gap: 14px;
                            padding: 12px 16px;
                            background: rgba(255,255,255,0.03);
                            border: 1px solid rgba(255,255,255,0.06);
                            border-radius: 10px;
                            transition: all 0.2s ease;
                            cursor: pointer;
                        }
                        .history-entry:hover { background: rgba(99, 102, 241, 0.08); border-color: rgba(99, 102, 241, 0.2); }
                        .history-entry.missing-file { opacity: 0.5; }

                        .history-icon {
                            width: 40px; height: 40px;
                            border-radius: 8px;
                            display: flex; align-items: center; justify-content: center;
                            font-size: 18px; flex-shrink: 0;
                        }
                        .history-icon.render { background: rgba(16, 185, 129, 0.15); color: #10b981; }
                        .history-icon.preview { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }

                        .history-info { flex: 1; min-width: 0; }
                        .history-scene {
                            font-size: 14px; font-weight: 600;
                            color: var(--text-primary);
                            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
                        }
                        .history-meta {
                            font-size: 12px; color: var(--text-secondary);
                            display: flex; gap: 12px; margin-top: 3px; flex-wrap: wrap;
                        }
                        .history-meta span { display: flex; align-items: center; gap: 4px; }

                        .history-entry-actions { display: flex; gap: 6px; flex-shrink: 0; }
                        .history-entry-btn {
                            width: 32px; height: 32px;
                            border: none; border-radius: 6px;
                            display: flex; align-items: center; justify-content: center;
                            cursor: pointer; font-size: 13px; transition: all 0.2s ease;
                            background: rgba(255,255,255,0.05); color: var(--text-secondary);
                        }
                        .history-entry-btn:hover { background: rgba(99, 102, 241, 0.2); color: #6366f1; }
                        .history-entry-btn.delete:hover { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
                        .history-entry.active { background: rgba(99, 102, 241, 0.12); border-color: rgba(99, 102, 241, 0.35); }

                        /* â”€â”€ History Video Player â”€â”€ */
                        .history-player {
                            display: none;
                            flex-direction: column;
                            background: #0d0d0d;
                            border: 1px solid rgba(255,255,255,0.08);
                            border-radius: 10px;
                            overflow: hidden;
                            flex-shrink: 0;
                        }
                        .history-player.visible { display: flex; }
                        .history-player-header {
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                            padding: 8px 12px;
                            background: rgba(255,255,255,0.03);
                            border-bottom: 1px solid rgba(255,255,255,0.06);
                        }
                        .history-player-title {
                            font-size: 12px;
                            font-weight: 600;
                            color: var(--text-secondary);
                            display: flex;
                            align-items: center;
                            gap: 6px;
                        }
                        .history-player-title i { color: #6366f1; }
                        .history-player-name {
                            color: var(--text-primary);
                            font-weight: 500;
                            max-width: 200px;
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                        }
                        .history-player-close {
                            width: 24px; height: 24px;
                            border: none; border-radius: 4px;
                            background: transparent; color: var(--text-secondary);
                            cursor: pointer; display: flex; align-items: center; justify-content: center;
                            font-size: 12px; transition: all 0.2s;
                        }
                        .history-player-close:hover { background: rgba(239,68,68,0.15); color: #ef4444; }
                        .history-player-viewport {
                            position: relative;
                            background: #000;
                            max-height: 280px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                        .history-player-viewport video {
                            width: 100%;
                            max-height: 280px;
                            object-fit: contain;
                        }
                    </style>
                    <div class="history-container">
                        <div class="history-header">
                            <div class="history-title">
                                <i class="fas fa-clock-rotate-left"></i> Render History
                            </div>
                            <div class="history-actions">
                                <button class="history-btn" onclick="refreshRenderHistory()">
                                    <i class="fas fa-arrows-rotate"></i> Refresh
                                </button>
                                <button class="history-btn danger" onclick="clearRenderHistory()">
                                    <i class="fas fa-trash"></i> Clear All
                                </button>
                            </div>
                        </div>
                        <!-- History Video Player (separate from workspace preview) -->
                        <div class="history-player" id="historyPlayer">
                            <div class="history-player-header">
                                <div class="history-player-title">
                                    <i class="fas fa-play-circle"></i>
                                    <span id="historyPlayerName">No video selected</span>
                                </div>
                                <button class="history-player-close" id="historyPlayerClose" title="Close player">
                                    <i class="fas fa-xmark"></i>
                                </button>
                            </div>
                            <div class="history-player-viewport">
                                <video id="historyPlayerVideo" controls preload="auto"></video>
                            </div>
                        </div>
                        <div class="history-list" id="historyList">
                            <div class="history-empty">
                                <i class="fas fa-clock-rotate-left"></i>
                                <div>No render history yet</div>
                                <div style="font-size:13px;opacity:0.7">Completed renders and previews will appear here</div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>
        </div>
    </div>
    <!-- Status Bar -->
    <footer class="status-bar">
        <div class="status-left">
            <span class="status-item">
                <i class="fas fa-circle" id="statusIndicator"></i>
                <span id="statusText">Ready</span>
            </span>
            <span class="status-item" id="currentFile">
                <i class="fas fa-file"></i>
                <span>Untitled</span>
            </span>
        </div>
        <div class="status-right">
            <span class="status-item" id="linesCount">Lines: 0</span>
            <span class="status-item" id="cursorPosition">Ln 1, Col 1</span>
            <span class="status-item" id="selectionInfo" style="display: none; color: #3b82f6;"></span>
            <span class="status-item" id="zoomControl" style="cursor: pointer; user-select: none;" title="Click to reset zoom">
                <i class="fas fa-search"></i>
                <span id="zoomLevel">100%</span>
            </span>
        </div>
    </footer>

    <!-- Manim Color Picker Floating Panel -->
    <div id="colorPickerPanel" class="color-picker-panel" style="display:none;">
        <style>
            .color-picker-panel {
                position: fixed; top: 60px; right: 20px;
                width: 320px; max-height: 70vh;
                background: var(--bg-secondary, #1e1e2e);
                border: 1px solid rgba(255,255,255,0.1);
                border-radius: 12px;
                box-shadow: 0 12px 40px rgba(0,0,0,0.5);
                z-index: 9000;
                display: flex; flex-direction: column;
                overflow: hidden;
                animation: colorPanelIn 0.2s ease-out;
            }
            @keyframes colorPanelIn { from { opacity:0; transform: translateY(-10px); } to { opacity:1; transform: translateY(0); } }
            .color-picker-header {
                display: flex; align-items: center; justify-content: space-between;
                padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.06);
            }
            .color-picker-header h3 { margin:0; font-size:15px; color: var(--text-primary, #e0e0e0); display:flex; align-items:center; gap:8px; }
            .color-picker-header h3 i { color: #a855f7; }
            .color-picker-close { background:none; border:none; color:var(--text-secondary,#888); cursor:pointer; font-size:16px; padding:4px 8px; border-radius:4px; }
            .color-picker-close:hover { background:rgba(255,255,255,0.1); color:var(--text-primary,#e0e0e0); }
            .color-picker-search { padding: 8px 16px; }
            .color-picker-search input {
                width: 100%; padding: 8px 12px; border-radius: 8px;
                border: 1px solid rgba(255,255,255,0.1);
                background: rgba(255,255,255,0.05); color: var(--text-primary,#e0e0e0);
                font-size: 13px; outline: none; box-sizing: border-box;
            }
            .color-picker-search input:focus { border-color: rgba(99,102,241,0.5); }
            .color-picker-body { flex:1; overflow-y:auto; padding: 8px 12px 12px; }
            .color-group-label { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.05em; color:var(--text-secondary,#888); padding:8px 4px 4px; }
            .color-grid { display: flex; flex-wrap: wrap; gap: 4px; padding-bottom: 6px; }
            .color-swatch {
                width: 36px; height: 36px; border-radius: 6px; cursor: pointer;
                border: 2px solid transparent; position: relative;
                transition: transform 0.15s, border-color 0.15s;
                display: flex; align-items: center; justify-content: center;
            }
            .color-swatch:hover { transform: scale(1.15); border-color: rgba(255,255,255,0.4); z-index: 1; }
            .color-swatch .tooltip {
                display: none; position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%);
                background: #111; color: #fff; padding: 4px 8px; border-radius: 4px;
                font-size: 11px; white-space: nowrap; pointer-events: none; z-index: 10;
            }
            .color-swatch:hover .tooltip { display: block; }
        </style>
        <div class="color-picker-header">
            <h3><i class="fas fa-palette"></i> Manim Colors</h3>
            <button class="color-picker-close" onclick="toggleColorPicker()" title="Close"><i class="fas fa-times"></i></button>
        </div>
        <div class="color-picker-search">
            <input type="text" id="colorSearchInput" placeholder="Search colors..." oninput="filterManimColors(this.value)">
        </div>
        <div class="color-picker-body" id="colorPickerBody">
            <!-- populated by JS -->
        </div>
    </div>

    <!-- Manim Docs Lookup Panel -->
    <div id="manimDocsPanel" class="manim-docs-panel">
        <div class="docs-header">
            <h3><i class="fas fa-book"></i> Manim Docs</h3>
            <button class="docs-close-btn" id="docsCloseBtn"><i class="fas fa-times"></i></button>
        </div>
        <div class="docs-search-wrap">
            <input type="text" id="docsSearchInput" placeholder="Search classes, animations, mobjects..." autocomplete="off">
        </div>
        <div class="docs-body" id="docsBody">
            <div class="docs-empty">
                <i class="fas fa-book-open"></i>
                Right-click a Manim class in the editor<br>and select <b>Lookup Manim Docs</b><br><br>
                Or search above to browse
            </div>
        </div>
    </div>

    <!-- Command Palette -->
    <div id="commandPalette" class="command-palette-overlay" style="display:none;">
        <div class="command-palette-box">
            <div class="command-palette-input-wrap">
                <i class="fas fa-angle-right"></i>
                <input type="text" id="commandPaletteInput" placeholder="Type a command..." autocomplete="off" spellcheck="false">
            </div>
            <div class="command-palette-results" id="commandPaletteResults"></div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutMapModal" class="shortcut-map-modal" style="display:none;">
        <div class="shortcut-map-content">
            <div class="shortcut-map-header">
                <h2><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h2>
                <div class="shortcut-search-wrap">
                    <i class="fas fa-search"></i>
                    <input type="text" id="shortcutSearch" placeholder="Search shortcuts..." autocomplete="off">
                </div>
                <button class="shortcut-map-close" id="closeShortcutMap"><i class="fas fa-times"></i></button>
            </div>
            <div class="shortcut-map-body" id="shortcutMapBody">
                <div class="shortcut-group">
                    <h3>File Operations</h3>
                    <div class="shortcut-row"><span class="shortcut-desc">New File</span><kbd>Ctrl</kbd>+<kbd>N</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Open File</span><kbd>Ctrl</kbd>+<kbd>O</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Save File</span><kbd>Ctrl</kbd>+<kbd>S</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Save As</span><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd></div>
                </div>
                <div class="shortcut-group">
                    <h3>Rendering</h3>
                    <div class="shortcut-row"><span class="shortcut-desc">Render Animation</span><kbd>F5</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Quick Preview</span><kbd>F6</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Stop Render</span><kbd>Esc</kbd></div>
                </div>
                <div class="shortcut-group">
                    <h3>Editor</h3>
                    <div class="shortcut-row"><span class="shortcut-desc">Find</span><kbd>Ctrl</kbd>+<kbd>F</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Find & Replace</span><kbd>Ctrl</kbd>+<kbd>H</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Select All</span><kbd>Ctrl</kbd>+<kbd>A</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Undo</span><kbd>Ctrl</kbd>+<kbd>Z</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Redo</span><kbd>Ctrl</kbd>+<kbd>Y</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Duplicate Line</span><kbd>Alt</kbd>+<kbd>Shift</kbd>+<kbd>Down</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Move Line Up</span><kbd>Alt</kbd>+<kbd>Up</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Move Line Down</span><kbd>Alt</kbd>+<kbd>Down</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Toggle Comment</span><kbd>Ctrl</kbd>+<kbd>/</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Multi-Cursor</span><kbd>Alt</kbd>+<kbd>Click</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Zoom In</span><kbd>Ctrl</kbd>+<kbd>=</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Zoom Out</span><kbd>Ctrl</kbd>+<kbd>-</kbd></div>
                </div>
                <div class="shortcut-group">
                    <h3>Navigation</h3>
                    <div class="shortcut-row"><span class="shortcut-desc">Go to Line</span><kbd>Ctrl</kbd>+<kbd>G</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Command Palette</span><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Scene Outline</span><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>O</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Keyboard Shortcuts</span><kbd>Ctrl</kbd>+<kbd>/</kbd></div>
                </div>
                <div class="shortcut-group">
                    <h3>Terminal</h3>
                    <div class="shortcut-row"><span class="shortcut-desc">Copy in Terminal</span><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>C</kbd></div>
                    <div class="shortcut-row"><span class="shortcut-desc">Paste in Terminal</span><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help and Settings Modals -->
    <!-- Include the modal HTML -->
    <script>
        // Load and inject the modals HTML
        fetch('app_features_modals.html?v=2025-02-25-v1.1.1.0')
            .then(response => response.text())
            .then(html => {
                // Create temp div to parse HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                // Append each modal directly to body (not wrapped in div)
                while (tempDiv.firstChild) {
                    document.body.appendChild(tempDiv.firstChild);
                }

                console.log('[MODALS] Modals loaded and injected into DOM');

                // Trigger event to signal modals are ready
                window.dispatchEvent(new Event('modalsReady'));
            })
            .catch(err => console.error('Failed to load modals:', err));
    </script>

    <!-- xterm.js Terminal Emulator -->
    <script>
        console.log('[XTERM LOAD] About to load xterm.js...');
        console.log('[XTERM LOAD] Document readyState:', document.readyState);
    </script>
    <script src="xterm/xterm.js" onload="console.log('[XTERM LOAD] xterm.js loaded successfully. Terminal available:', typeof Terminal !== 'undefined')" onerror="console.error('[XTERM LOAD] Failed to load xterm.js!')"></script>
    <script>
        console.log('[XTERM LOAD] After loading xterm.js - Terminal constructor:', typeof Terminal);
        console.log('[XTERM LOAD] After loading xterm.js - window.Terminal:', typeof window.Terminal);
    </script>

    <!-- Monaco Editor - AMD Loader -->
    <script src="monaco/vs/loader.js"></script>
    <script>
        // Configure AMD loader path
        require.config({ paths: { 'vs': 'monaco/vs' } });

        // Set up Monaco Environment for web workers
        window.MonacoEnvironment = {
            getWorkerUrl: function(workerId, label) {
                return 'monaco/vs/base/worker/workerMain.js';
            }
        };

        console.log('Monaco AMD loader configured');
        console.log('require available:', typeof require !== 'undefined');
    </script>

    <!-- Python + Manim completions provider (zero-lag, client-side IntelliSense) -->
    <script src="python-completions.js"></script>

    <!-- LSP client â€” connects Monaco to basedpyright running in Python host -->
    <script src="lsp-client.js"></script>

    <!-- Main Application Script - Load renderer_desktop.js directly -->
    <!-- Cache buster added to force reload after fixes - change version to force reload -->
    <script src="renderer_desktop.js?v=2025-02-19-completions"></script>

    <!-- New Features: File Upload via PyWebView Dialog -->
    <script src="new_features.js?v=2025-01-26-windows-details-view"></script>

    <!-- App Features: Theme Toggle, Help Modal, Settings Dialog -->
    <script src="app_features.js?v=2025-01-26-v14-pywebview-ready-fix"></script>

    <!-- SIMPLE ASSETS - NO CACHE -->
    <script src="simple_assets.js?nocache"></script>

    <!-- Responsive Scaling & DPI Detection -->
    <script src="responsive_scaling.js?v=2025-02-05"></script>
</body>
</html>
